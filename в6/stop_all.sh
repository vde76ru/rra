#!/bin/bash
# stop_all.sh - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–æ—Ç–∞

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Crypto Trading Bot"
echo "============================================="

# –ü–æ–∏—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
echo -e "\nüîç –ü–æ–∏—Å–∫ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."

# –ò—â–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã app.py
APP_PIDS=$(pgrep -f "python.*app.py")
if [ ! -z "$APP_PIDS" ]; then
    echo "üìå –ù–∞–π–¥–µ–Ω –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (PID: $APP_PIDS)"
    kill $APP_PIDS
    echo "‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
else
    echo "‚ö†Ô∏è  –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –∑–∞–ø—É—â–µ–Ω"
fi

# –ò—â–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã main_simple.py
MAIN_PIDS=$(pgrep -f "python.*main_simple.py")
if [ ! -z "$MAIN_PIDS" ]; then
    echo "üìå –ù–∞–π–¥–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ü–µ–Ω (PID: $MAIN_PIDS)"
    kill $MAIN_PIDS
    echo "‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ü–µ–Ω –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
else
    echo "‚ö†Ô∏è  –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ü–µ–Ω –Ω–µ –∑–∞–ø—É—â–µ–Ω"
fi

# –ò—â–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã main.py
BOT_PIDS=$(pgrep -f "python.*main.py" | grep -v main_simple)
if [ ! -z "$BOT_PIDS" ]; then
    echo "üìå –ù–∞–π–¥–µ–Ω –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç (PID: $BOT_PIDS)"
    kill $BOT_PIDS
    echo "‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
else
    echo "‚ö†Ô∏è  –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
echo -e "\nüîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤..."
if lsof -Pi :8000 -sTCP:LISTEN -t >/dev/null 2>&1; then
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 8000 –≤—Å–µ –µ—â–µ –∑–∞–Ω—è—Ç"
    PORT_PID=$(lsof -Pi :8000 -sTCP:LISTEN -t)
    echo "üìå –ü—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 8000 (PID: $PORT_PID)"
    kill -9 $PORT_PID 2>/dev/null
    echo "‚úÖ –ü–æ—Ä—Ç 8000 –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω"
else
    echo "‚úÖ –ü–æ—Ä—Ç 8000 —Å–≤–æ–±–æ–¥–µ–Ω"
fi

echo -e "\n‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!"