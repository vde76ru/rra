#!/bin/bash

echo "๐ === ะะะะฃะกะ ะะกะะะะะะะะะะ ะกะะกะขะะะซ ==="

# ะะตัะตัะพะดะธะผ ะฒ ัะฐะฑะพััั ะดะธัะตะบัะพัะธั
cd /var/www/www-root/data/www/systemetech.ru

# ะะบัะธะฒะธััะตะผ ะฒะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต
source venv/bin/activate

# ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะธัะฟัะฐะฒะปะตะฝะฝัะต ะทะฐะฒะธัะธะผะพััะธ
echo "๐ฆ ะะฑะฝะพะฒะปัะตะผ ะทะฐะฒะธัะธะผะพััะธ..."
pip install --upgrade passlib[bcrypt]
pip install --upgrade bcrypt

# ะกะพะทะดะฐะตะผ ะฝะพะฒัะต ัะฐะนะปั
echo "๐ ะกะพะทะดะฐะตะผ ะฝะพะฒัะต ัะฐะนะปั..."
# (ะทะดะตัั ัะฐะนะปั ัะถะต ัะพะทะดะฐะฝั ะฒััะต)

# ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฒัะต ััะฐััะต ะฟัะพัะตััั
echo "๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ััะฐััะต ะฟัะพัะตััั..."
pkill -f "python.*main.py" || true
pkill -f "python.*app.py" || true

# ะัะธัะฐะตะผ ััะฐััะต PID ัะฐะนะปั
rm -f bot.pid app.pid

# ะะฐะฟััะบะฐะตะผ ะฒะตะฑ-ะธะฝัะตััะตะนั
echo "๐ ะะฐะฟััะบะฐะตะผ ะฒะตะฑ-ะธะฝัะตััะตะนั..."
nohup python app_fixed.py > logs/web.log 2>&1 &
echo $! > app.pid

echo "โ ะกะธััะตะผะฐ ะทะฐะฟััะตะฝะฐ!"
echo "๐ ะะตะฑ-ะธะฝัะตััะตะนั: http://0.0.0.0:8000"
echo "๐ ะัะพะฒะตัั ััะฐััั ะฒ ะดะฐัะฑะพัะดะต"